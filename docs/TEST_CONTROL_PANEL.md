# テストコントロールパネル使用ガイド

## 概要

警備ロボット監視システムに**テストコントロールパネル**機能を追加しました！
実際のロボットがなくても、手動でダミーデータを送信してシステムをテストできます。

## 機能一覧

### 1. ⚠️ ダミーアラート送信

カスタムアラートをFirebaseに送信できます。

#### 設定項目:
- **アラート種類**: 動体検知、音声検知、侵入検知、システム
- **重要度**: 低、中、高、緊急
- **場所**: 自由入力（例: 1階エントランス）
- **説明**: アラートの詳細説明

#### 使い方:
1. 各項目を設定
2. 「📤 アラートを送信」ボタンをクリック
3. リアルタイムで監視画面に反映されます

---

### 2. 🤖 ロボット状態更新

ロボットの状態情報を更新できます。

#### 設定項目:
- **ロボットID**: 既存ロボット（ガード01〜03）または新規作成
- **新しいロボット名**: 新規作成時のみ
- **場所**: ロボットの現在位置
- **オンライン状態**: ON/OFF切り替え
- **バッテリーレベル**: 0〜100%（スライダー）

#### 使い方:
1. ロボットを選択または新規作成
2. 各項目を設定
3. 「📤 ロボット状態を更新」ボタンをクリック
4. リアルタイムで監視画面に反映されます

---

### 3. ⚡ クイックアクション

よく使う操作をワンクリックで実行できます。

#### アクション一覧:

| ボタン | 説明 |
|--------|------|
| 🎲 ランダムアラート | ランダムなアラートを自動生成して送信 |
| 🚨 緊急アラート | 重要度「緊急」の侵入検知アラートを送信 |
| ⚙️ システム通知 | システムメッセージを送信 |
| 🔋 全ロボット充電 | 全ロボットのバッテリーを100%に更新 |

---

### 4. 📊 送信ステータス

操作の成功/失敗をリアルタイムで確認できます。

#### ログの種類:
- ✅ **成功**: 緑色のログ（データ送信成功）
- ❌ **エラー**: 赤色のログ（送信失敗、権限エラーなど）
- ℹ️ **情報**: 青色のログ（一般的な情報）

最新10件のログが表示されます。

---

## 使用例

### 例1: 侵入検知アラートを送信

```
1. パネルを開く（「▶ 開く」ボタン）
2. アラート種類: 「🚨 侵入検知」を選択
3. 重要度: 「🔴 緊急」を選択
4. 場所: 「裏口」と入力
5. 説明: 「不正侵入の可能性があります」と入力
6. 「📤 アラートを送信」ボタンをクリック
7. ステータスログに「✅ アラートを送信しました」と表示
8. 監視画面に新しいアラートが表示される
```

### 例2: 新しいロボットを追加

```
1. ロボットID: 「➕ 新しいロボット」を選択
2. 新しいロボット名: 「ガード04」と入力
3. 場所: 「3階会議室」と入力
4. オンライン状態: ONに設定
5. バッテリーレベル: 95%に設定
6. 「📤 ロボット状態を更新」ボタンをクリック
7. 監視画面に新しいロボットカードが表示される
```

### 例3: テストシナリオを実行

```
1. 「🔋 全ロボット充電」をクリック
   → 全ロボットのバッテリーが100%になる

2. 「🎲 ランダムアラート」を数回クリック
   → 様々な種類のアラートが生成される

3. 「🚨 緊急アラート」をクリック
   → 緊急アラートが画面上部に表示される

4. 監視画面でリアルタイム更新を確認
```

---

## Firebase セキュリティについて

### 重要な注意事項

現在のシステムは**読み取り専用モード**を推奨しています。

#### database.rules.public.json (推奨)
```json
{
  "rules": {
    ".read": true,
    ".write": false
  }
}
```

この設定では:
- ✅ **読み取り**: 誰でも可能
- ❌ **書き込み**: 完全禁止

### テストコントロールパネルを使用する場合

書き込み権限が必要です。以下のいずれかの方法を選択してください:

#### オプション1: テスト期間中のみ書き込み許可（推奨）

Firebase Consoleで一時的に書き込みを許可:

```json
{
  "rules": {
    ".read": true,
    ".write": true  // ⚠️ テスト期間中のみ
  }
}
```

**⚠️ 警告**: テスト終了後は必ず `.write: false` に戻してください！

#### オプション2: Firebase Consoleから手動でデータ追加

1. [Firebase Console](https://console.firebase.google.com/) にアクセス
2. プロジェクト「guard-robo-back」を選択
3. Realtime Database → データタブ
4. 手動でデータを追加/編集

この方法なら書き込み権限は不要です。

#### オプション3: 認証付き書き込み（本番環境推奨）

```json
{
  "rules": {
    ".read": true,
    ".write": "auth != null"  // 認証済みユーザーのみ
  }
}
```

Firebase Authenticationと組み合わせて使用します。

---

## トラブルシューティング

### Q1: 「送信に失敗しました」と表示される

**原因**: Firebase書き込み権限がない

**解決策**:
1. Firebase Consoleでセキュリティルールを確認
2. 一時的に `.write: true` に変更（テスト時のみ）
3. または Firebase Console から手動でデータを追加

### Q2: データが反映されない

**原因**: ネットワーク接続の問題

**解決策**:
1. ブラウザのコンソールを開く（F12キー）
2. ネットワークエラーがないか確認
3. Firebase接続状態を確認（画面上部のステータス表示）
4. ページをリロード

### Q3: パネルが表示されない

**原因**: ビルドエラーまたはコンポーネント読み込み失敗

**解決策**:
```bash
# ビルドし直す
npm run build

# 開発サーバーを再起動
npm run dev
```

### Q4: ログが表示されない

**原因**: ブラウザのキャッシュ

**解決策**:
1. ブラウザのキャッシュをクリア
2. スーパーリロード（Ctrl + Shift + R）

---

## 開発者向け情報

### ファイル構成

```
src/
├── components/
│   ├── GuardRobotMonitor.vue      # 監視画面
│   └── TestControlPanel.vue       # テストコントロールパネル ← 新規
├── services/
│   └── guard-robot-service.ts     # Firebase通信サービス
└── App.vue                         # メインアプリ（更新）
```

### 主要メソッド

#### `guardRobotService.addAlert(alert)`
新しいアラートをFirebaseに追加します。

```typescript
const alert = {
  timestamp: Date.now(),
  type: 'motion',
  severity: 'medium',
  location: '1階エントランス',
  description: 'テストアラート',
  status: 'active'
}

await guardRobotService.addAlert(alert)
```

#### `guardRobotService.updateRobotStatus(robot)`
ロボットの状態を更新します。

```typescript
const robot = {
  id: 'robot-001',
  name: 'ガード01',
  location: '1階エントランス',
  isOnline: true,
  batteryLevel: 85,
  lastHeartbeat: Date.now()
}

await guardRobotService.updateRobotStatus(robot)
```

---

## まとめ

テストコントロールパネルを使うことで:

✅ 実際のロボットなしでシステムをテストできる  
✅ 様々なシナリオを手動で再現できる  
✅ UIのリアルタイム更新を確認できる  
✅ Firebase統合をテストできる  

仲間のロボットが完成するまで、このパネルで開発とテストを進められます！

---

## 次のステップ

1. **テスト**: 様々なアラートとロボット状態を試す
2. **カスタマイズ**: 必要に応じてアラート種類や重要度を追加
3. **セキュリティ**: 本番環境では必ず書き込み権限を制限
4. **実機統合**: ロボットが完成したらAPIエンドポイントを接続

楽しくテストしてください！🎮🤖
